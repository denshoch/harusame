# Harusame 要件定義書

## 1. 基本要件
- 日本語の縦書きテキストにおける文字の向きを制御するライブラリを提供すること
- 特定の文字や文字列を適切な向きで表示できるようにすること
- HTMLテキストを入力として受け取り、適切なクラスを付与したHTMLを出力すること

## 2. 機能要件

### 2.1 縦中横（Tate-Chu-Yoko）処理
- 指定された桁数（デフォルト2桁）の数字を`<span class="tcy">`でラップすること
- 連続する感嘆符・疑問符（例：!!, ??, !?）を`<span class="tcy">`でラップすること
- 桁数は設定可能であること（0以上の整数）
- 0を指定した場合は縦中横処理を行わないこと

### 2.2 文字の向き制御
- 特定の文字を正立（upright）または横転（sideways）で表示できるようにすること
- 以下の文字を適切な向きで表示すること：
  - 正立（upright）：ギリシャ文字、キリル文字、ローマ数字、記号類
  - 横転（sideways）：数学記号（÷, ∴, ≠等）
- 文字の向き制御はオプションで無効化可能であること

### 2.3 除外処理
- 以下の要素は変換処理から除外すること：
  - 特定のタグ内のテキスト（code, pre, math, svg）
  - URL
  - メールアドレス
  - HTML文字参照
  - 既に変換済みの要素（tcy, upright, sidewaysクラスを持つ要素）

## 3. 非機能要件

### 3.1 エラー処理
- 不正なHTML/XMLに対して適切なエラー処理を行うこと
- エラー発生時は元のテキストを返却すること
- エラーメッセージをログに出力すること

### 3.2 パフォーマンス
- 大量のテキストを効率的に処理できること
- メモリ使用を最適化すること
- 正規表現処理を最適化すること

### 3.3 拡張性
- オプションによる設定変更が可能であること
- 新しい文字パターンの追加が容易であること

### 3.4 互換性
- PHP 7.4以上で動作すること
- UTF-8エンコーディングをサポートすること

## 4. インターフェース要件

### 4.1 入力
- プレーンテキストまたはHTML形式のテキスト
- オプション設定（tcyDigit, autoTextOrientation）

### 4.2 出力
- 適切なクラスが付与されたHTML形式のテキスト
- エラー時は元のテキストをそのまま返却

### 4.3 設定可能なオプション
- tcyDigit: 縦中横処理を行う数字の最大桁数（0以上の整数）
- autoTextOrientation: 文字の向き自動調整の有効/無効（真偽値） 